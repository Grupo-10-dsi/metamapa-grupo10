# ================================================
# VARIABLES DE ENTORNO PARA RAILWAY
# ================================================
# Copia estas variables a cada servicio en Railway Dashboard
# Reemplaza los valores entre <> con los valores reales

# ================================================
# MYSQL (Proveído automáticamente por Railway)
# ================================================
# Railway crea estas variables automáticamente cuando agregas MySQL
# Referencia usando: ${{MySQL.VARIABLE_NAME}}

MYSQL_HOST=${{MySQL.MYSQLHOST}}
MYSQL_PORT=${{MySQL.MYSQLPORT}}
MYSQL_USER=${{MySQL.MYSQLUSER}}
MYSQL_PASSWORD=${{MySQL.MYSQLPASSWORD}}

# Bases de datos adicionales (crear manualmente en MySQL)
MYSQL_DB_AGREGADOR=agregador_db
MYSQL_DB_DINAMICA=dinamica_db
MYSQL_DB_ESTADISTICA=estadistica_db
MYSQL_DB_GESTOR=gestor_db

# ================================================
# KEYCLOAK (Servicio: keycloak)
# ================================================
KC_DB=mysql
KC_DB_URL_HOST=${{MySQL.MYSQLHOST}}
KC_DB_URL_PORT=${{MySQL.MYSQLPORT}}
KC_DB_URL_DATABASE=keycloak_db
KC_DB_USERNAME=${{MySQL.MYSQLUSER}}
KC_DB_PASSWORD=${{MySQL.MYSQLPASSWORD}}
KC_BOOTSTRAP_ADMIN_USERNAME=admin
KC_BOOTSTRAP_ADMIN_PASSWORD=admin
KC_HTTP_PORT=8080
KC_HTTP_ENABLED=true
KC_HOSTNAME_STRICT=false
KC_PROXY_HEADERS=xforwarded

# ================================================
# API GATEWAY (Servicio: api-gateway)
# ================================================
# URLs internas (usar .railway.internal)
KEYCLOAK_URL=http://keycloak.railway.internal:8080/realms/MetaMapa
KEYCLOAK_JWK_SET_URI=http://keycloak.railway.internal:8080/realms/MetaMapa/protocol/openid-connect/certs
ESTADISTICA_URL=http://estadistica.railway.internal:8088
DINAMICA_URL=http://dinamica.railway.internal:8082
AGREGADOR_URL=http://agregador.railway.internal:8080

# Issuers válidos (incluir URL pública y privada de Keycloak)
KEYCLOAK_VALID_ISSUERS=https://${{keycloak.RAILWAY_PUBLIC_DOMAIN}}/realms/MetaMapa,http://keycloak.railway.internal:8080/realms/MetaMapa

# ================================================
# FRONTEND (Servicio: visualizador)
# ================================================
# URL pública del API Gateway
REACT_APP_API_GATEWAY_URL_BASE=https://${{api-gateway.RAILWAY_PUBLIC_DOMAIN}}
REACT_APP_KEYCLOAK_CLIENT_ID=metamapa-frontend

# ================================================
# AGREGADOR (Servicio: agregador)
# ================================================
SPRING_DATASOURCE_URL=jdbc:mysql://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/agregador_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
SPRING_DATASOURCE_USERNAME=${{MySQL.MYSQLUSER}}
SPRING_DATASOURCE_PASSWORD=${{MySQL.MYSQLPASSWORD}}
ESTATICA_URL=http://estatica.railway.internal:8081
DINAMICA_URL=http://dinamica.railway.internal:8082
PROXY_URL=http://proxy.railway.internal:8083
NORMALIZADOR_URL=http://normalizador.railway.internal:8087

# ================================================
# DINAMICA (Servicio: dinamica)
# ================================================
SPRING_DATASOURCE_URL=jdbc:mysql://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/dinamica_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
SPRING_DATASOURCE_USERNAME=${{MySQL.MYSQLUSER}}
SPRING_DATASOURCE_PASSWORD=${{MySQL.MYSQLPASSWORD}}
GESTOR_PERSONAS_URL=http://gestor-personas.railway.internal:8091
SUPABASE_URL=<tu-supabase-url>
SUPABASE_BUCKET=multimedia
SUPABASE_SERVICE_KEY=<tu-supabase-service-key>

# ================================================
# ESTADISTICA (Servicio: estadistica)
# ================================================
SPRING_DATASOURCE_URL=jdbc:mysql://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/estadistica_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
SPRING_DATASOURCE_USERNAME=${{MySQL.MYSQLUSER}}
SPRING_DATASOURCE_PASSWORD=${{MySQL.MYSQLPASSWORD}}
AGREGADOR_URL=http://agregador.railway.internal:8080

# ================================================
# GESTOR-PERSONAS (Servicio: gestor-personas)
# ================================================
SPRING_DATASOURCE_URL=jdbc:mysql://${{MySQL.MYSQLHOST}}:${{MySQL.MYSQLPORT}}/gestor_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
SPRING_DATASOURCE_USERNAME=${{MySQL.MYSQLUSER}}
SPRING_DATASOURCE_PASSWORD=${{MySQL.MYSQLPASSWORD}}

# ================================================
# PROXY (Servicio: proxy)
# ================================================
METAMAPA_INSTANCIA_URL=http://proxyEjemplo.railway.internal:8092

# ================================================
# NOTAS IMPORTANTES
# ================================================
# 1. Las variables ${{servicio.VARIABLE}} son referencias de Railway
# 2. Railway reemplaza automáticamente estas referencias en runtime
# 3. Networking privado usa: <servicio>.railway.internal:<puerto>
# 4. URLs públicas usan: ${{servicio.RAILWAY_PUBLIC_DOMAIN}}
# 5. NO comitees valores reales de secrets en Git
